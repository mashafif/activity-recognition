---
title: "Human Activity Recognition using Smartphone"
author: "Mashlahul Afif"
date: "April 6, 2019"
output: html_document
---



##Background
This project is the capstone project for Introduction to Data Science from Springboard

##Data Wrangling

###*Necessary Datasets*


The necessary datasets consists of the following:
*X_train.txt - contains sensors reading data that consists of 561 variables, and 7352 observations
*Y_train.txt - contains the information regarding the activity corresponds to each observation above
*subject_train.txt - contains the Subject which performs the above experiments.
*feature.txt - information about all features correspond to observations of above x_train.txt dataset.

###*Loading the dataset*

First step is to load the dataset which is obtained from UCI Machine Learning Repository.

```{r}

library(dplyr)
library(stringr)
library(ggplot2)

#Loading the measurement data set
x_train<-read.table("train/X_train.txt")
#Loading the dataset for activity labels
y_train<-data.frame(ActivityLabel=read.table("train/Y_train.txt"))
subject_id<- data.frame(Subject=read.table("train/subject_train.txt"))
subject_id<- setNames(subject_id,"Subject")
```

###*Adding Features to the Sensor Reading Dataset*

Features are loaded from features.txt dataset. Features on this file is not appropiate for features naming, because most the data contains prohibited characters, also some features names are duplicated.
Thus, the next step is to clean up the feature labels from this features.txt, using gsub() and make.names().
Function make.names() is primarily used to efficiently solve the label duplication.

```{r}
#Loading the feature name for each column
label<-read.table("features.txt", col.names=c("id","Name"))

#correct the label dataset, so it can be used to name the measurement data set "x_train"
true_label<-label%>%
            mutate(Feature=make.names(Name,unique=TRUE))%>%
            mutate(Feature=gsub("^f","Frequency.",Feature))%>%
            mutate(Feature=gsub("^t","Time.",Feature))%>%
            mutate(Feature = gsub("^angle", "Angle", Feature)) %>%
            mutate(Feature = gsub("BodyBody", "Body", Feature)) %>%
            mutate(Feature = gsub("Acc", ".Acc", Feature)) %>%
            mutate(Feature = gsub("Gyro", ".Gyro", Feature)) %>%
            mutate(Feature = gsub("Jerk", ".Jerk", Feature)) %>%
            mutate(Feature = gsub("Mag", ".Mag", Feature)) %>%
            mutate(Feature = gsub("\\.{2,}", ".", Feature)) %>%
            mutate(Feature = gsub("\\.+$", "", Feature)) %>%
            select(Feature)%>%
            unlist()


#Add name to the measurement data set
x_train<-setNames(x_train,true_label)
```

###*Adding Actitivity Label from y dataset*

To make it more understandable, activity label, which consists of numbering of each activity, will be converted to actual activities correspond to each numbering. 

```{r}
#Converting the activity label to activity name
y_train<-setNames(y_train,"ActivityLabel")
y_train<-y_train %>% mutate(ActivityName=case_when(ActivityLabel==1~"WALKING",
                                          ActivityLabel==2~"WALKING_UPSTAIRS",
                                          ActivityLabel==3~"WALKING_DOWNSTAIRS",
                                          ActivityLabel==4~"SITTING",
                                          ActivityLabel==5~"STANDING",
                                          ActivityLabel==6~"LAYING"))

y_train$ActivityName<- as.factor(y_train$ActivityName)
```                   

###*Combining All Dataset Together*

Next step is to combine all of the datasets above to human.activity dataset.
Furthermore, indices will also be added for data exploratory and visualization purpose.
These new features basically serve as time stamp for data visualization that will be done later.
The indices' features consist of the following:

*Overall.ID - time stamp for all observations, which start from no 1 to the end of row numbers' observation.
*Activity.ID - time stamp that is unique for each activity.
*Subject.ID - time stamp that is unique for each subject.
*Subject.Activity.ID - time stamp that is unique for each activity within each subject.

```{r}
#Combining both measurement data set to its activity label dataset
human.activity<-cbind(subject_id,y_train,x_train)
human.activity<-human.activity%>%
                mutate(Overall.ID=as.numeric(row_number()))

human.activity <- human.activity %>% 
                  group_by(ActivityName) %>% 
                  mutate(Activity.ID=row_number()) 
human.activity <- human.activity %>% 
                  group_by(Subject) %>%
                  mutate(Subject.ID=row_number())
human.activity <- human.activity %>%
                  group_by(Subject,ActivityName)%>% 
                  mutate(Subject.Activity.ID=row_number())%>%
                  select(Overall.ID,Subject.ID,Activity.ID,Subject.Activity.ID,everything())
```

##Data Exploratory and Data Visualization

###*Distribution of Activities*

The distrubtion for all activities across all subjects are shown below:
```{r}
#to see the distribution of all activities
ggplot(human.activity, aes(x=ActivityName,fill=ActivityName))+
  geom_bar()+
  theme_bw()+
  theme(legend.position = "none", axis.text.x=element_text(angle=45,hjust=1))+
  labs(title="Distribution of Activities")

#to see the distribution of all activities done by each subject      
ggplot(human.activity, aes(x=Subject,fill=ActivityName))+
  geom_bar()+
  theme_bw()+
  theme(legend.position = "none", axis.text.x=element_text(angle=45,hjust=1))+
  labs(title="Distribution of Activities")
```

As shown above the distribution of activities is not equal. 
Therefore, the following dataset will be created, which are useful to equalize the number of observations for the data visualizations later.

```{r}
minmax.activity<-human.activity%>%
                 group_by(ActivityName)%>%
                 summarize(max.activity=max(Activity.ID))

minmax.subject.activity <-human.activity%>%
                         group_by(Subject, ActivityName)%>%
                         summarize(max.activity=max(Subject.Activity.ID))
```

###*Order of Experiment*

In what order the experiment was performed in term of subjects are shown below: 

```{r}
#to see in what order the experiment was performed in term of subject
ggplot(human.activity, aes(x=Overall.ID, y=Subject))+
  geom_line(size=2,color="blue")+
  xlab("Index")+
  ylab("Subject")+
  theme_bw() +
  labs(title="Order of Subject During Experiment")
```

As shown above, no repetition in term of subjects' order. Each subject only done the experiment once, before continuing to the next subject.


Next, is to show the order of activiy done by each subject.
```{r}
#to see in what order the experiment was performed in term of activity
ggplot(human.activity, aes(x=Subject.ID, y=ActivityLabel, col=ActivityLabel))+
  geom_line(size=2)+
  scale_color_distiller(palette = "RdPu")+
  facet_wrap(Subject~.,ncol=7)+
  xlab("Index")+
  ylab("Activity Label")+
  theme_bw() +
  labs(title="Order of Activity done by each Subject during Experiment")
```

As shown above, all subjects done the same order of activities.

###*Time Series Visualization*

Next step is to show the time series visualization of Accelerator reading across all subjects:

```{r}
#Drawing the Mean of Body Accelration accross all Subjects
human.activity%>%filter(Activity.ID<=min(minmax.activity$max.activity))%>%
ggplot(aes(x=Activity.ID))+
  geom_line(aes(y=Time.Body.Acc.mean.X),color="red")+
  geom_line(aes(y=Time.Body.Acc.mean.Y),color="blue")+
  geom_line(aes(y=Time.Body.Acc.mean.Z),color="green")+
  facet_grid(ActivityName~.)+
  xlab("Index")+
  ylab("Mean Acceleration")+
  theme_bw() +
  theme(strip.text = element_text(size = 4.5))+
  labs(title="Mean of Body Acceleration Plot of All Subjects")
  

#Drawing the SD of Body Acceleration accross all Subjects
human.activity%>%filter(Activity.ID<=min(minmax.activity$max.activity))%>%
  ggplot(aes(x=Activity.ID))+
  geom_line(aes(y=Time.Body.Acc.std.X),color="red")+
  geom_line(aes(y=Time.Body.Acc.std.Y),color="blue")+
  geom_line(aes(y=Time.Body.Acc.std.Z),color="green")+
  facet_grid(ActivityName~.)+
  xlab("Index")+
  ylab("STD Acceleration")+
  theme_bw() +
  theme(strip.text = element_text(size = 4.5))+
  labs(title="Standard Deviation of Body Acceleration Plot of All Subjects")
```

From the time series data above, we can cleary observe clear pattern difference between stationary activities (standing, sitting, laying), and the moving activities(walking, etc).
As we can see seeing reading across all subjects is not something that is easy to see
Next will be to explore the sensors reading for only 1 subject = subject no 3

###*Time Series Visualization for One Subject*

Next step is to show the time series visualization of Accelerator reading only for Subject 5:

```{r}

Subjects <- minmax.subject.activity%>%
                   filter(Subject==5)
Subjects.length<- min(Subjects$max.activity)
Subjects.length



#Body Accelration Reading Mean of subject no 5
human.activity%>%filter(Subject==5,Subject.Activity.ID<=Subjects.length)%>%
  ggplot(aes(x=Subject.Activity.ID))+
  geom_line(aes(y=Time.Body.Acc.mean.X),color="red")+
  geom_line(aes(y=Time.Body.Acc.mean.Y),color="blue")+
  geom_line(aes(y=Time.Body.Acc.mean.Z),color="green")+
  facet_grid(ActivityName~.)+
  xlab("Index")+
  ylab("Mean Acceleration")+
  theme_bw() +
  theme(strip.text = element_text(size = 4.5))+
  labs(title="Mean of Body Acceleration Plot of Subject 5")


#Body Accelration Reading SD of subject no 5
human.activity%>%filter(Subject==5,Subject.Activity.ID<=Subjects.length)%>%
  ggplot(aes(x=Subject.Activity.ID))+
  geom_line(aes(y=Time.Body.Acc.std.X),color="red")+
  geom_line(aes(y=Time.Body.Acc.std.Y),color="blue")+
  geom_line(aes(y=Time.Body.Acc.std.Z),color="green")+
  facet_grid(ActivityName~.)+
  xlab("Index")+
  ylab("std Acceleration")+
  theme_bw() +
  theme(strip.text = element_text(size = 4.5))+
  labs(title="Std of Body Acceleration Plot of Subject 5")

#Body Acceleration Magnitude of subject
human.activity%>%filter(Subject==5,Subject.Activity.ID<=Subjects.length)%>%
  ggplot(aes(x=Subject.Activity.ID))+
  geom_line(aes(y=Time.Body.Acc.Mag.mean),color="purple")+
  facet_grid(ActivityName~.)+
  xlab("Index")+
  ylab("std Acceleration")+
  theme_bw() +
  theme(strip.text = element_text(size = 4.5))+
  labs(title="Std of Body Acceleration Plot of Subject 5")
```

Next step is to show the time series visualization of Gyroscope reading only for Subject 5:

```{r}
#----------------------------------------Gyro Time Series Line---------------------------------------------

#Body Gyroscope Reading Mean of subject no 5
human.activity%>%filter(Subject==5,Subject.Activity.ID<=Subjects.length)%>%
  ggplot(aes(x=Subject.Activity.ID))+
  geom_line(aes(y=Time.Body.Gyro.mean.X),color="red")+
  geom_line(aes(y=Time.Body.Gyro.mean.Y),color="blue")+
  geom_line(aes(y=Time.Body.Gyro.mean.Z),color="green")+
  facet_grid(ActivityName~.)+
  xlab("Index")+
  ylab("Mean Gyroscope")+
  theme_bw() +
  theme(strip.text = element_text(size = 4.5))+
  labs(title="Mean of Body Gyroscope Plot of Subject 5")


#Body Gyroscope Reading SD of subject no 5
human.activity%>%filter(Subject==5,Subject.Activity.ID<=Subjects.length)%>%
  ggplot(aes(x=Subject.Activity.ID))+
  geom_line(aes(y=Time.Body.Gyro.std.X),color="red")+
  geom_line(aes(y=Time.Body.Gyro.std.Y),color="blue")+
  geom_line(aes(y=Time.Body.Gyro.std.Z),color="green")+
  facet_grid(ActivityName~.)+
  xlab("Index")+
  ylab("std Gyroscope")+
  theme_bw() +
  theme(strip.text = element_text(size = 4.5))+
  labs(title="Std of Body Gyroscope Plot of Subject 5")

#Body Gyroscope Magnitude of subject
human.activity%>%filter(Subject==5,Subject.Activity.ID<=Subjects.length)%>%
  ggplot(aes(x=Subject.Activity.ID))+
  geom_line(aes(y=Time.Body.Gyro.Mag.mean),color="purple")+
  facet_grid(ActivityName~.)+
  xlab("Index")+
  ylab("std Gyroscope")+
  theme_bw() +
  theme(strip.text = element_text(size = 4.5))+
  labs(title="Std of Body Gyroscope Plot of Subject 5")
```

Next step is to show the time series visualization of Gravity reading only for Subject 5:

```{r}
#----------------------------------------Gravity Time Series Line---------------------------------------------

#Body Gravity Reading Mean of subject no 5
human.activity%>%filter(Subject==5,Subject.Activity.ID<=Subjects.length)%>%
  ggplot(aes(x=Subject.Activity.ID))+
  geom_line(aes(y=Time.Gravity.Acc.mean.X),color="red")+
  geom_line(aes(y=Time.Gravity.Acc.mean.Y),color="blue")+
  geom_line(aes(y=Time.Gravity.Acc.mean.Z),color="green")+
  facet_grid(ActivityName~.)+
  xlab("Index")+
  ylab("Mean Gravity")+
  theme_bw() +
  theme(strip.text = element_text(size = 4.5))+
  labs(title="Mean of Body Gravity Plot of Subject 5")


#Body Gravity Reading SD of subject no 5
human.activity%>%filter(Subject==5,Subject.Activity.ID<=Subjects.length)%>%
  ggplot(aes(x=Subject.Activity.ID))+
  geom_line(aes(y=Time.Gravity.Acc.std.X),color="red")+
  geom_line(aes(y=Time.Gravity.Acc.std.Y),color="blue")+
  geom_line(aes(y=Time.Gravity.Acc.std.Z),color="green")+
  facet_grid(ActivityName~.)+
  xlab("Index")+
  ylab("std Gravity")+
  theme_bw() +
  theme(strip.text = element_text(size = 4.5))+
  labs(title="Std of Body Gravity Plot of Subject 5")

#Body Gravity Magnitude of subject
human.activity%>%filter(Subject==5,Subject.Activity.ID<=Subjects.length)%>%
  ggplot(aes(x=Subject.Activity.ID))+
  geom_line(aes(y=Time.Gravity.Acc.Mag.mean),color="purple")+
  facet_grid(ActivityName~.)+
  xlab("Index")+
  ylab("std Gravity")+
  theme_bw() +
  theme(strip.text = element_text(size = 4.5))+
  labs(title="Std of Body Gravity Plot of Subject 5")
```


###*Histogram Visualization for All Activities*

To understand the data further, next step is to show the histogram of Accelerator, Gyroscope, and Gravity Reading across all subjects:

```{r}
#----------------------------------------Histogram Accelerator Time Series---------------------------------------------

#Histogram Body Acceleration Magnitude of All Subjects
human.activity%>%filter(Activity.ID<=min(minmax.activity$max.activity))%>%
  ggplot()+
  geom_histogram(binwidth=0.05,aes(x=Time.Body.Acc.mean.X),fill="red", alpha=0.6)+
  geom_histogram(binwidth=0.05,aes(x=Time.Body.Acc.mean.Y),fill="blue",alpha=0.6)+
  geom_histogram(binwidth=0.05,aes(x=Time.Body.Acc.mean.Z),fill="green",alpha=0.6)+
  facet_grid(ActivityName~.)+
  theme_bw() +
  theme(strip.text = element_text(size = 4.5))+
  xlab("Index")+
  ylab("Acceleration Reading")+
  labs(title="Mean of Body Acceleration Reading Plot")


#----------------------------------------Histogram Gyroscope Time Series---------------------------------------------

#Histogram Body Gyroscope Magnitude of All Subjects
human.activity%>%filter(Activity.ID<=min(minmax.activity$max.activity))%>%
  ggplot()+
  geom_histogram(binwidth=0.05,aes(x=Time.Body.Gyro.mean.X),fill="red", alpha=0.6)+
  geom_histogram(binwidth=0.05,aes(x=Time.Body.Gyro.mean.Y),fill="blue",alpha=0.6)+
  geom_histogram(binwidth=0.05,aes(x=Time.Body.Gyro.mean.Z),fill="green",alpha=0.6)+
  facet_grid(ActivityName~.)+
  theme_bw() +
  theme(strip.text = element_text(size = 4.5))+
  xlab("Index")+
  ylab("Acceleration Reading")+
  labs(title="Mean of Body Gyroscope Reading Plot")


#----------------------------------------Histogram Gravity Reading TimeSeries---------------------------------------------

#Histogram Body Gravity Magnitude of All Subjects
human.activity%>%filter(Activity.ID<=min(minmax.activity$max.activity))%>%
  ggplot()+
  geom_histogram(binwidth=0.05,aes(x=Time.Gravity.Acc.mean.X),fill="red", alpha=0.6)+
  geom_histogram(binwidth=0.05,aes(x=Time.Gravity.Acc.mean.Y),fill="blue",alpha=0.6)+
  geom_histogram(binwidth=0.05,aes(x=Time.Gravity.Acc.mean.Z),fill="green",alpha=0.6)+
  facet_grid(ActivityName~.)+
  theme_bw() +
  theme(strip.text = element_text(size = 4.5))+
  xlab("Index")+
  ylab("Acceleration Reading")+
  labs(title="Mean of Body Gravity Reading Plot")
```